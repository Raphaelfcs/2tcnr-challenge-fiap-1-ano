define(["lodash","app/plugins/sdk"],function(e,t){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GridDBConstant={VARIABLE_QUERY_TYPES:{GET_ALL_CONTAINERS:"CONTAINERS",GET_ALL_COLUMNS:"COLUMNS",GET_DATA:"DATA"},GRIDDB_TIMESAMPLING_TYPE:{day:"DAY",hour:"HOUR",minute:"MINUTE",second:"SECOND",millisecond:"MILLISECOND"},GRAFANA_TIME_UNITS_TYPE:{millisecond:"ms",seconds:"s",minutes:"m",hours:"h",days:"d",weeks:"w",months:"M",years:"y"},FORMAT:{table:"table",timeSeries:"time_series"},NUMBER_TYPE_GRIDDB:{byte:"BYTE",short:"SHORT",integer:"INTEGER",long:"LONG",float:"FLOAT",double:"DOUBLE"},GRIDDB_GET_CONTAINERS_LIMIT:1e3,GRIDDB_CONTAINER_TYPE:{COLLECTION:"COLLECTION",TIMESERIES:"TIME_SERIES"}}},function(t,r){t.exports=e},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),a=r(3),o=r(0),s=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.whereParts=[],this.target=t,this.scopedVars=r,this.griddbUtil=new a.default}var t,r,s;return t=e,(r=[{key:"render",value:function(){var e="";return this.target.rawQuery?this.target.query:(e+=this.getSELECTCommand(),e+=this.getWHERECommand(),e+=this.getLimitCommand(),this.target.griddbTQL=e,e)}},{key:"getSELECTCommand",value:function(){var e="";return"SELECT "+(e+=!!this.target.griddbIsTimeSampling&&this.target.griddbIsTimeSampling?"$__timeSampling(*, $__interval)":"*")+" FROM "+(this.target.griddbContainer.text?this.target.griddbContainer.text:"")}},{key:"getWHERECommand",value:function(){var e=this,t="";if(this.target.griddbWheres&&this.target.griddbWheres.length>0){var r=i.map(this.target.griddbWheres,function(t,r){return e.renderTagCondition(t,r)});t=" WHERE",r.forEach(function(e){t+=e}),t=this.addTimeFilter(t,!0)}else t=this.addTimeFilter(t,!1);return t}},{key:"getLimitCommand",value:function(){var e="",t=this.target.griddbLimit,r=this.target.griddbOffset;if(null!==t&&!isNaN(Number(t))){if(t<0)throw{message:"Limit cannot smaller than 0"};if(e=" LIMIT "+this.target.griddbLimit,null!==r&&!isNaN(Number(r))){if(r<0)throw{message:"Offset cannot smaller than 0"};e=e+" OFFSET "+this.target.griddbOffset}}return e}},{key:"addTimeFilter",value:function(e,t){var r=this.target&&this.target.griddbTimeColumn?this.target.griddbTimeColumn.text:"",n="";if(r){var i="("+r+" > $__timeFrom AND "+r+" < $__timeTo)";this.target.format===o.GridDBConstant.FORMAT.table&&this.target.griddbTimeColumn.fake&&(i=""),t&&i?n=" AND ":!t&&i&&(i=" WHERE "+i),e=e+n+i}return e}},{key:"renderTagCondition",value:function(e,t){var r="",n=e.operator,i=e.value?e.value.trim():"",a=e.key?e.key.trim():"";return t>0&&(r=" "+e.condition),r+" "+("null"===i.toLowerCase()?this.getClauseForNullValue(a,n,i):"false"===i.toLowerCase()||"true"===i.toLowerCase()?this.getClauseForBooleanColumn(a,n,i.toLowerCase()):a+" "+n+" "+i)}},{key:"getClauseForBooleanColumn",value:function(e,t,r){var n="";return"false"===r?"="===t?n="NOT "+e:"<>"===t&&(n=e):"true"===r?"="===t?n=e:"<>"===t&&(n="NOT "+e):n=e+" "+t+" "+r,n}},{key:"getClauseForNullValue",value:function(e,t,r){return"="===t?e+" IS null":"<>"===t?e+" IS NOT null":e+" "+t+" "+r}}])&&n(t.prototype,r),s&&n(t,s),e}();t.default=s},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,a;return t=e,a=[{key:"convertToWhereCondition",value:function(e){if(void 0!==e&&e.length>0){var t=[];return e.forEach(function(e){t.push({text:e.name,value:e.name})}),t}return[]}},{key:"createDataForViewCol",value:function(e){if(void 0!==e&&e.length>0){var t=[];return e.forEach(function(e){t.push({selected:!1,text:e,value:e})}),t.splice(0,0,{selected:!1,text:"All",value:"$__all"}),{options:t,tags:[],current:{},includeAll:!0,multi:!0}}return{}}},{key:"getViewColListinTimeSeries",value:function(e){if(void 0!==e&&e.length>0){var t=[];return e.forEach(function(e){e.type!==i.GridDBConstant.NUMBER_TYPE_GRIDDB.byte&&e.type!==i.GridDBConstant.NUMBER_TYPE_GRIDDB.double&&e.type!==i.GridDBConstant.NUMBER_TYPE_GRIDDB.float&&e.type!==i.GridDBConstant.NUMBER_TYPE_GRIDDB.integer&&e.type!==i.GridDBConstant.NUMBER_TYPE_GRIDDB.long&&e.type!==i.GridDBConstant.NUMBER_TYPE_GRIDDB.short||t.push(e.name)}),t}return[]}},{key:"convertToSegmentFormat",value:function(e){if(void 0!==e&&e.length>0){var t=[];return e.forEach(function(e){t.push({text:e,value:e,fake:!1})}),t}return[]}},{key:"convertListContainerToObject",value:function(e){if(void 0!==e&&e.length>0){var t=[];return e.forEach(function(e){t.push({text:e,value:e})}),t}return[]}}],(r=null)&&n(t.prototype,r),a&&n(t,a),e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5);t.Datasource=n.Datasource;var i=r(13);t.QueryCtrl=i.DataQueryCtrl;var a=r(15);t.ConfigCtrl=a.ConfigCtrl;var o=r(16);t.AnnotationsQueryCtrl=o.AnnotationsQueryCtrl},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),a=r(2),o=r(6),s=r(7),u=r(8),l=r(0),c=r(9),d=r(10),g=r(11),m=r(12),h=function(){function e(t,r,n,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cluster=t.jsonData.xgridcluster,this.database="public",this.minInterval=(t.jsonData||{}).minInterval,this.urls=i.map(t.url.split(","),function(e){return e.trim()}),this.$q=r,this.backendSrv=n,this.templateSrv=a,this.templateProcessor=new u.default,this.gridDBAPI=new o.default(this.cluster,this.database)}var t,r,h;return e.$inject=["instanceSettings","$q","backendSrv","templateSrv"],t=e,(r=[{key:"query",value:function(e){var t=this,r=e.scopedVars,n=i.cloneDeep(e.targets).filter(function(e){return t.isValidQuery(e)});if(0===n.length)return this.$q.when({});var o=[],s=[];if(n.forEach(function(n){var i=n.griddbTimeColumn,u=n.alias?n.alias.trim():n.alias,c=new a.default(n,r),d=i.text?i.text:"",g=c.render(),h={timeColumn:n.rawQuery?[]:[d],interval:t.minInterval,variables:t.templateSrv.variables,templateSrv:t.templateSrv,scopedVars:r,timeRange:{intervalMs:e.intervalMs,range:e.range}};g=t.templateProcessor.replace(g,h);var f="";n.rawQuery?f=(new m.default).getContainer(g):(f=n.griddbContainer.text?n.griddbContainer.text:"",f=t.templateProcessor.replace(f,h));f=t.templateSrv.replace(f,r);var T=n.griddbSelectedViewCols;T.indexOf(d)<0&&n.format===l.GridDBConstant.FORMAT.timeSeries&&T.push(d),s.push({raw:n.rawQuery,data_format:n.format,alias:u,timeColumn:n.rawQuery?"":d});var v={name:f,stmt:g,columns:n.rawQuery?null:T};o.push(v)}),0===o.length)return this.$q.when({data:[]});var u=this.gridDBAPI.executeTQL(o);return this._griddbRequest(u).then(function(e){if(!e||!e[0])return[];var t=new c.default;return t.refine(s,e),{data:t.format(o,e,s)}}).catch(function(e){console.warn(e);throw{message:e.data?e.data.errorMessage:e.message,data:"string",config:e.config}})}},{key:"testDatasource",value:function(){var e=this.gridDBAPI.testConnection();return this._griddbRequest(e).then(function(e){var t=i.get(e,"results[0].error");return t?{status:"error",message:t}:{status:"success",message:"Data source is working"}}).catch(function(e){return{status:"error",message:e.message}})}},{key:"annotationQuery",value:function(e){var t=e.annotation.timeColumn,r=e.annotation.startTimeColumn,n=e.annotation.endTimeColumn,i=e.annotation.textColumn,a=e.annotation.tagsColumn,o=e.annotation.container,s=e.annotation.isRegionsAnnotation,u=e.annotation.query;if(!u)return this.$q.reject({status:"error",message:"Query missing in annotation definition"});if(!o)return this.$q.reject({status:"error",message:"Query missing in container name"});if(!s&&!t)return this.$q.reject({status:"error",message:"Query missing in time column"});if(s){if(!r)return this.$q.reject({status:"error",message:"Query missing in start time column"});if(!n)return this.$q.reject({status:"error",message:"Query missing in end time column"});if(r===n)return this.$q.reject({status:"error",message:"Start time column must be difference with end time column"})}var l={timeColumn:[t],interval:this.minInterval,variables:e.variables,templateSrv:this.templateSrv,scopedVars:e.scopedVars,timeRange:{intervalMs:this.templateSrv.intervalMs,range:e.range}};s?(l.timeColumn=[r,n],u=this.templateProcessor.replace(u,l)):u=this.templateProcessor.replace(u,l);var c=[{name:o,stmt:u,columns:s?this.getSelectedFields(r,i,a,n):this.getSelectedFields(t,i,a)}],g=this.gridDBAPI.executeTQL(c);return this._griddbRequest(g).then(function(i){var a;if(i[0]&&(a=i[0]),!a||!a.columns)throw{status:"error",message:"Query to get annotation fail"};var o=a.columns?a.columns.map(function(e){return e.name}):[];if(s){if(!o.includes(r))throw{status:"error",message:"Start time column is not existed in GridDB column"};if("TIMESTAMP"!==a.columns.filter(function(e){return e.name===r})[0].type.toUpperCase())throw{status:"error",message:"Start time column is not TIMESTAMP column"};if(!o.includes(n))throw{status:"error",message:"End time column is not existed in GridDB column"};if("TIMESTAMP"!==a.columns.filter(function(e){return e.name===n})[0].type.toUpperCase())throw{status:"error",message:"End time column is not TIMESTAMP column"}}else{if(!o.includes(t))throw{status:"error",message:"Time column is not existed in GridDB column"};if("TIMESTAMP"!==a.columns.filter(function(e){return e.name===t})[0].type.toUpperCase())throw{status:"error",message:"Time column is not TIMESTAMP column"}}if(!a.results[0])throw{status:"error",message:"No results in response from GridDB"};return new d.default({data:a,annotation:e.annotation}).getAnnotations(s)}).catch(function(e){console.warn(e);throw{message:e.data?e.data.errorMessage:e.message,data:"string",config:e.config}})}},{key:"metricFindQuery",value:function(e){var t=new g.default,r=new s.default(e).parse(),n={};switch(r.type){case l.GridDBConstant.VARIABLE_QUERY_TYPES.GET_ALL_CONTAINERS:n=this.gridDBAPI.getContainers(l.GridDBConstant.GRIDDB_GET_CONTAINERS_LIMIT);break;case l.GridDBConstant.VARIABLE_QUERY_TYPES.GET_ALL_COLUMNS:var i=r.container;n=this.gridDBAPI.getSchema(i);break;case l.GridDBConstant.VARIABLE_QUERY_TYPES.GET_DATA:var a=r.container,o=r.columns,u=[{name:a,stmt:r.tql,columns:o}];n=this.gridDBAPI.executeTQL(u)}return this._griddbRequest(n).then(function(e){return t.format(r.type,e)}).catch(function(e){console.warn(e);throw{message:e.data?e.data.errorMessage:e.message,data:"string",config:e.config}})}},{key:"_griddbRequest",value:function(e){var t=e.method,r=e.url,n=e.data,a=e.params?e.params:{},o=this.urls.shift();if(this.urls.push(o),!r)return this.$q.when({results:[]});"GET"===t&&(i.extend(a,n),n=null);var s={method:t,url:o+r,params:a,data:n,inspect:{type:"griddb"}};return n&&n[0]&&n[0].stmt&&n.forEach(function(e){console.log("Data request: \n"),console.log(e)}),this.backendSrv.datasourceRequest(s).then(function(e){return e.data},function(e){if(0!==e.status||e.status>=300)throw e.data&&e.data.error?{message:"GridDB Error: "+e.data.error,data:e.data,config:e.config}:{message:"Network Error: "+e.statusText+"("+e.status+")",data:e.data,config:e.config}})}},{key:"getContainerList",value:function(){var e=this.gridDBAPI.getContainers(l.GridDBConstant.GRIDDB_GET_CONTAINERS_LIMIT);return this._griddbRequest(e)}},{key:"getColumnList",value:function(e){var t=this.gridDBAPI.getSchema(e);return this._griddbRequest(t)}},{key:"getSelectedFields",value:function(e,t,r,n){var a=[];e&&a.push(e),t&&a.push(t),n&&a.push(n);var o=[];return r&&r.trim().length>0&&(o=(o=r.split(",")).map(function(e){return e.trim()})),a=a.concat(o),a=i.uniq(a)}},{key:"isValidQuery",value:function(e){if(e.hide)return!1;if(e.rawQuery){if(!e.query||!e.query.trim())return!1}else{var t=e.griddbContainer;if(!t||!t.text)return!1;var r=e.griddbSelectedContainerType;if(r&&r.toUpperCase()===l.GridDBConstant.GRIDDB_CONTAINER_TYPE.COLLECTION)if(!!e.griddbIsTimeSampling&&e.griddbIsTimeSampling)throw{message:"Time sampling not available with collection container"};if(e.format===l.GridDBConstant.FORMAT.timeSeries){var n=e.griddbTimeColumn;if(!n||n&&n.fake)return!1;if(!e.griddbSelectedViewCols||0===e.griddbSelectedViewCols.length)return!1}if(e.format===l.GridDBConstant.FORMAT.table&&"select-container"===e.griddbContainer.value)return!1}return!0}}])&&n(t.prototype,r),h&&n(t,h),e}();t.Datasource=h},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0});t.GRIDDB_API_LIST={testDatasource:"/griddb/v2/{0}/dbs/{1}/checkConnection",TQLQuery:"/griddb/v2/{0}/dbs/{1}/tql",containers:"/griddb/v2/{0}/dbs/{1}/containers",schema:"/griddb/v2/{0}/dbs/{1}/containers/{2}/info"};var i=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cluster=t,this.database=r}var r,i,a;return r=e,(i=[{key:"executeTQL",value:function(e){return{url:this.getURL(t.GRIDDB_API_LIST.TQLQuery,[this.cluster,this.database]),method:"POST",data:e}}},{key:"testConnection",value:function(){return{url:this.getURL(t.GRIDDB_API_LIST.testDatasource,[this.cluster,this.database]),method:"GET",data:{},param:{timeout:1}}}},{key:"getContainers",value:function(e){var r={limit:e};return{url:this.getURL(t.GRIDDB_API_LIST.containers,[this.cluster,this.database]),method:"GET",data:{},params:r}}},{key:"getSchema",value:function(e){return{url:this.getURL(t.GRIDDB_API_LIST.schema,[this.cluster,this.database,e]),method:"GET",data:{}}}},{key:"getURL",value:function(e,t){var r,n=t.length;for(r=0;r<n;r++){var i="\\{"+r+"\\}",a=encodeURIComponent(t[r]);e=e.replace(new RegExp(i,"g"),a)}return e}}])&&n(r.prototype,i),a&&n(r,a),e}();t.default=i},function(e,t,r){"use strict";function n(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.allColumnsRegex=/^\$griddb_column_list\((\w+)\)$/g,this.getDataRegex=/^\$griddb_query_data\(([^,]+),([^,+]+(?:\+[^,+]+)*),(.*)\)$/g,this.getAllContainerRegex="$griddb_container_list",this.query=t}var t,r,o;return t=e,(r=[{key:"detectQueryType",value:function(){var e="";if(this.query=this.query.trim(),this.query===this.getAllContainerRegex)e=a.GridDBConstant.VARIABLE_QUERY_TYPES.GET_ALL_CONTAINERS;else if(this.query.match(this.allColumnsRegex))e=a.GridDBConstant.VARIABLE_QUERY_TYPES.GET_ALL_COLUMNS;else{if(!this.query.match(this.getDataRegex)){throw{message:"Query is wrong format. Please choose one of three formats below:\n1. $griddb_container_list. \n2. $griddb_column_list({container name})\n3. $griddb_query_data({container name}, {columns}, {TQL})"}}e=a.GridDBConstant.VARIABLE_QUERY_TYPES.GET_DATA}return e}},{key:"parse",value:function(){var e=this.detectQueryType(),t={};switch(e){case a.GridDBConstant.VARIABLE_QUERY_TYPES.GET_ALL_CONTAINERS:t={type:e};break;case a.GridDBConstant.VARIABLE_QUERY_TYPES.GET_ALL_COLUMNS:var r=(""+this.allColumnsRegex.exec(this.query)[1]).trim();if(!r)throw{message:"Container name must be not empty or null"};t={type:e,container:r};break;case a.GridDBConstant.VARIABLE_QUERY_TYPES.GET_DATA:var n=this.getDataRegex.exec(this.query),i=(""+n[3]).trim();if(!i)throw{message:"TQL statement must be not empty or null"};var o=n[1].trim();if(!o)throw{message:"Container name must be not empty or null"};var s=n[2].trim(),u=this.getColumns(s);if(!u||0===u.length)throw{message:"Column name must be not empty or null"};t={type:e,container:o,columns:u,tql:i}}return t}},{key:"getColumns",value:function(e){var t=[];if(!e)return null;if((t=e.split("+").map(function(e){return e.trim()})).filter(function(e){return!e}).length>0)throw{message:"Column name must be not empty or null"};return t=n(new Set(t))}}])&&i(t.prototype,r),o&&i(t,o),e}();t.default=o},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TIME_SAMPLING_REGEX=/(\$__timeSampling\(([^(),]+),([^(),]+)\))/g,this.TIME_FILTER_REGEX=/(\$__timeFilter)/g,this.TIME_RANGE_FILTER_REGEX=/(\$__rangeFilter)/g,this.INTERVAL_REGEX=/(\$__interval)/g,this.MIN_INTERVAL_REGEX=/(\$__minInterval)/g,this.TIME_COLUMN_REGEX=/(\$__timeColumn)/g,this.TIME_FROM_REGEX=/(\$__timeFrom)/g,this.TIME_TO_REGEX=/(\$__timeTo)/g,this.ALL_OPTIONS_TO_REGEX=/(\$__all)/gi,this.MS_DATE_TYPE_REGEX=/([0-9]+)(ms)/g,this.S_DATE_TYPE_REGEX=/([0-9]+)(s)$/g,this.M_DATE_TYPE_REGEX=/([0-9]+)(m)$/g,this.H_DATE_TYPE_REGEX=/([0-9]+)(h)$/g,this.D_DATE_TYPE_REGEX=/([0-9]+)(d)$/g,this.W_DATE_TYPE_REGEX=/([0-9]+)(w)$/g,this.MONTH_DATE_TYPE_REGEX=/([0-9]+)(M)$/g,this.Y_DATE_TYPE_REGEX=/([0-9]+)(y)$/g}var t,r,a;return t=e,(r=[{key:"replace",value:function(e,t){var r=t.timeColumn,n=t.interval,i=t.timeRange,a=t.templateSrv,o=t.scopedVars;if(1===r.length&&r[0]&&(e=this.formatTimeFilterMacro(e,r[0])),2===r.length){var s=r[0],u=r[1];e=this.formatTimeRangeMacro(e,s,u)}return e=this.formatTimeSamplingMacro(e),e=(r.length,this.formatSpecialVariables(e,n,i)),a&&o&&(e=this.formatCustomVariables(a,o,e)),e}},{key:"formatTimeSamplingMacro",value:function(e){for(var t=this.TIME_SAMPLING_REGEX.exec(e);t&&t.length>=4;){var r=(""+t[0]).trim(),n=(""+t[2]).trim(),i=(""+t[3]).trim(),a="";if("$__interval"===i||"$__minInterval"===i)a="TIME_SAMPLING("+n+", $__timeFrom, $__timeTo, "+i+")";else{var o=this.convertTimeInTimeSampling(i);a="TIME_SAMPLING("+n+", $__timeFrom, $__timeTo, "+o.value+", "+o.type+")"}e=e.replace(r,a),t=this.TIME_SAMPLING_REGEX.exec(e)}return e}},{key:"convertTimeInTimeSampling",value:function(e){var t=this.getGrafanaTimeType(e),r=+(""+e.substring(0,e.length-t.length).trim()),n="",a=0;switch(isNaN(r)||(a=+r),t){case i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.years:a*=365,n=i.GridDBConstant.GRIDDB_TIMESAMPLING_TYPE.day;break;case i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.months:a*=30,n=i.GridDBConstant.GRIDDB_TIMESAMPLING_TYPE.day;break;case i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.weeks:a*=7,n=i.GridDBConstant.GRIDDB_TIMESAMPLING_TYPE.day;break;case i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.days:n=i.GridDBConstant.GRIDDB_TIMESAMPLING_TYPE.day;break;case i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.hours:n=i.GridDBConstant.GRIDDB_TIMESAMPLING_TYPE.hour;break;case i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.minutes:n=i.GridDBConstant.GRIDDB_TIMESAMPLING_TYPE.minute;break;case i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.seconds:n=i.GridDBConstant.GRIDDB_TIMESAMPLING_TYPE.second;break;case i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.millisecond:n=i.GridDBConstant.GRIDDB_TIMESAMPLING_TYPE.millisecond}return{value:a,type:n}}},{key:"convertGrafanaTimeToGridDBTimestamp",value:function(e){var t="";return e&&(t="TIMESTAMP('"+(t=e.utc().format("YYYY-MM-DDTHH:mm:ss.SSS"))+"Z')"),t}},{key:"formatTimeFilterMacro",value:function(e,t){var r="("+t+" > $__timeFrom AND "+t+" < $__timeTo)";return e=e.replace(this.TIME_FILTER_REGEX,r)}},{key:"formatTimeRangeMacro",value:function(e,t,r){if(t&&r){var n="(("+t+" >= $__timeFrom AND "+t+" <= $__timeTo) OR ("+r+" >= $__timeFrom AND "+r+" <= $__timeTo))";e=e.replace(this.TIME_RANGE_FILTER_REGEX,n)}return e}},{key:"convertTimeToMillisecond",value:function(e){var t="",r=this.getGrafanaTimeType(e);return e?(e&&e.length>1&&(t=e.substring(0,e.length-1)),r===i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.seconds?1e3*+t:r===i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.minutes?60*+t*1e3:r===i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.hours?60*+t*60*1e3:r===i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.days?24*+t*60*60*1e3:r===i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.millisecond?+e.substring(0,e.length-2):-1):-1}},{key:"formatSpecialVariables",value:function(e,t,r){var n=r.intervalMs?r.intervalMs:"0",a=this.convertTimeToMillisecond(t),o=(n<a?a:n)+", "+i.GridDBConstant.GRIDDB_TIMESAMPLING_TYPE.millisecond,s=a+", "+i.GridDBConstant.GRIDDB_TIMESAMPLING_TYPE.millisecond;if(e=(e=e.replace(this.INTERVAL_REGEX,o)).replace(this.MIN_INTERVAL_REGEX,s),r.range){var u=this.convertGrafanaTimeToGridDBTimestamp(r.range.from);e=e.replace(this.TIME_FROM_REGEX,u);var l=this.convertGrafanaTimeToGridDBTimestamp(r.range.to);e=e.replace(this.TIME_TO_REGEX,l)}return e}},{key:"formatCustomVariables",value:function(e,t,r){return e.replace(r,t,this.interpolateQueryStr)}},{key:"interpolateQueryStr",value:function(e,t){return t.multi||t.includeAll?"string"==typeof e?e:e instanceof Array&&1===e.length?e[0]:"("+e.map(function(e){return e.replace(/[\\^$*+?.()|[\]{}\/]/g,"\\$&")}).join("|")+")":e}},{key:"getGrafanaTimeType",value:function(e){if(e){if(e.match(this.MS_DATE_TYPE_REGEX))return i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.millisecond;if(e.match(this.S_DATE_TYPE_REGEX))return i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.seconds;if(e.match(this.M_DATE_TYPE_REGEX))return i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.minutes;if(e.match(this.H_DATE_TYPE_REGEX))return i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.hours;if(e.match(this.D_DATE_TYPE_REGEX))return i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.days;if(e.match(this.W_DATE_TYPE_REGEX))return i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.weeks;if(e.match(this.MONTH_DATE_TYPE_REGEX))return i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.months;if(e.match(this.Y_DATE_TYPE_REGEX))return i.GridDBConstant.GRAFANA_TIME_UNITS_TYPE.years;throw{message:"Cannot detect format of grafana time"}}return""}}])&&n(t.prototype,r),a&&n(t,a),e}();t.default=a},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ALIAS_COLUMN_REGEX=/(\$__col)/g,this.CONTAINER_REGEX=/(\$__container)/g}var t,r,a;return t=e,(r=[{key:"refine",value:function(e,t){var r=this;e.forEach(function(e,n){var a="",o=t[n].columns,s=e.data_format;if(e.raw&&s===i.GridDBConstant.FORMAT.timeSeries){var u=o.filter(function(e){return"TIMESTAMP"===e.type});a=u&&1===u.length?u[0].name:""}else{if(e.raw||s!==i.GridDBConstant.FORMAT.timeSeries){if(s===i.GridDBConstant.FORMAT.table)return;throw{message:"Cannot detect format of data"}}a=e.timeColumn}var l=r.swap(a,t[n]);t[n]=l})}},{key:"format",value:function(e,t,r){var n=this,a=[],o=e.map(function(e){return e.name});return t.forEach(function(e,t){var s=e.columns,u=e.results,l=o[t],c=r[t].alias;if(u&&u.length>0)if(r[t].data_format===i.GridDBConstant.FORMAT.timeSeries)a=a.concat(n.convertToTimeSeriesData(s,l,u,c));else{if(r[t].data_format!==i.GridDBConstant.FORMAT.table)throw{message:"System not support this format"};a=a.concat(n.convertToTableData(s,l,u,c))}}),a}},{key:"convertToTimeSeriesData",value:function(e,t,r,n){var i=this,a=[];if(e.length<2||r&&r[0].length<2)throw{message:"Not enough data to draw Graph"};return e.forEach(function(o,s){if(s===e.length-1)return"";var u,l={target:"",datapoints:[]};for(l.target=i.getGraphLineName(o.name,t,n),u=0;u<r.length;u++){var c=r[u],d=i.convertLocalTimeStampToEpochTime(c[e.length-1]);l.datapoints.push([c[s],d])}a.push(l)}),a}},{key:"convertToTableData",value:function(e,t,r,n){var i=this,a={},o=[];return e.forEach(function(e){var r={text:i.getGraphLineName(e.name,t,n)};o.push(r)}),a.columns=o,a.rows=r.map(function(t){return t.splice(0,e.length)}),a.type="table",a}},{key:"convertLocalTimeStampToEpochTime",value:function(e){return new Date(e).getTime()}},{key:"getGraphLineName",value:function(e,t,r){var n="";return r?(r.match(this.CONTAINER_REGEX)&&(r=r.replace(this.CONTAINER_REGEX,t)),r&&r.match(this.ALIAS_COLUMN_REGEX)&&(r=r.replace(this.ALIAS_COLUMN_REGEX,e)),n=r):n=t+"."+e,n}},{key:"swap",value:function(e,t){var r=this,n=t.columns,i=n.map(function(e){return e.name}),a=t.results,o=i.indexOf(e);return n=this.swapObj(n,o,i.length),a.forEach(function(e){e=r.swapObj(e,o,i.length)}),t.columns=n,t.results=a,t}},{key:"swapObj",value:function(e,t,r){if(t>-1){var n=e.splice(t,1)[0];e.splice(r,1,n)}return e}}])&&n(t.prototype,r),a&&n(t,a),e}();t.default=a},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.containers=t.data,this.annotation=t.annotation}var t,r,a;return t=e,(r=[{key:"getAnnotations",value:function(e){return e?this.getRegionsAnnotation():this.getNormalAnnotation()}},{key:"getNormalAnnotation",value:function(){var e,t=this,r=[],n=this.containers,a="",o=[],s="";for(e=0;e<n.columns.length;e++){var u=n.columns[e].name,l=""+e;u===this.annotation.timeColumn&&(a=l);var c=(this.annotation.tagsColumn||"").split(" ").join("").split(",");i.includes(c,u)&&o.push(l),u===this.annotation.textColumn&&(s=l)}return i.each(n.results,function(e){var n={annotation:t.annotation,time:new Date(e[a]).getTime(),tags:i.flatten(o.filter(function(t){return e[t]}).map(function(t){return""+(""+e[t]).split(",")})),text:e[s]?""+e[s]:""};r.push(n)}),r}},{key:"getRegionsAnnotation",value:function(){var e,t=this,r=[],n=this.containers,a="",o="",s=[],u="";for(e=0;e<n.columns.length;e++){var l=n.columns[e].name,c=""+e;l===this.annotation.startTimeColumn&&(a=c),l===this.annotation.endTimeColumn&&(o=c);var d=(this.annotation.tagsColumn||"").split(" ").join("").split(",");i.includes(d,l)&&s.push(c),l===this.annotation.textColumn&&(u=c)}return i.each(n.results,function(e,n){if(e[a]<e[o]){var l={annotation:t.annotation,time:new Date(e[a]).getTime(),regionId:""+n,tags:i.flatten(s.filter(function(t){return e[t]}).map(function(t){return""+(""+e[t]).split(",")})),text:e[u]?""+e[u]:""},c={time:new Date(e[o]).getTime(),regionId:""+n};r.push(l),r.push(c)}}),r}}])&&n(t.prototype,r),a&&n(t,a),e}();t.default=a},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),a=r(0),o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,o;return t=e,(r=[{key:"format",value:function(e,t){var r;switch(e){case a.GridDBConstant.VARIABLE_QUERY_TYPES.GET_DATA:var n=t[0];r=this.getOptionsForDATAQuery(n);break;case a.GridDBConstant.VARIABLE_QUERY_TYPES.GET_ALL_CONTAINERS:r=this.getOptionsForCONTAINERSQuery(t);break;case a.GridDBConstant.VARIABLE_QUERY_TYPES.GET_ALL_COLUMNS:r=this.getOptionsForCOLUMNSQuery(t);break;default:r=[]}return r}},{key:"getOptionsForDATAQuery",value:function(e){var t=this;if(!e||!e.columns||!e.results)return[];var r={};return i.each(e.results,function(e){t.addUnique(r,e[0])}),i.map(r,function(e){return{text:""+e}})}},{key:"getOptionsForCONTAINERSQuery",value:function(e){var t=this;if(!e||!e.names||0===e.names.length)return[];var r={};return i.each(e.names,function(e){var n=e.trim();t.addUnique(r,n)}),i.map(r,function(e){return{text:""+e}})}},{key:"getOptionsForCOLUMNSQuery",value:function(e){var t=this;if(!e||!e.columns||0===e.columns.length)return[];var r={};return i.each(e.columns,function(e){var n=e.name.trim();t.addUnique(r,n)}),i.map(r,function(e){return{text:""+e}})}},{key:"addUnique",value:function(e,t){e[t]=t}}])&&n(t.prototype,r),o&&n(t,o),e}();t.default=o},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.GET_CONTAINER_REGEX=/^\s*select.*[\s*)']from\s+([a-zA-Z0-9_]*)\s*(?:$|limit|order|where).*$/gi}var t,r,i;return t=e,(r=[{key:"getContainer",value:function(e){if(e&&e.trim()){if(!(e=e.replace(/(\r\n|\n|\r)/gm," ")).match(this.GET_CONTAINER_REGEX))throw{message:"Query is wrong format"};var t=this.GET_CONTAINER_REGEX.exec(e);if(!(t&&t.length>1&&t[1]))throw{message:"Cannot detect container name from query"};return(""+t[1]).trim()}throw{message:"Query must be not empty"}}}])&&n(t.prototype,r),i&&n(t,i),e}();t.default=i},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(t,"__esModule",{value:!0});var u=r(14),l=r(2),c=r(1),d=r(0),g=r(3),m=function(e){function t(e,r,n,i,s){var u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(u=a(this,o(t).call(this,e,r))).templateSrv=n,u.$q=i,u.uiSegmentSrv=s,u.queryModel=new l.default(u.target,n),u.removeTagFilterSegment=s.newSegment({fake:!0,value:"--remove--"}),u.target=u.target,u.target.griddbWheres=u.target.griddbWheres||[],u.target.griddbContainer=u.target.griddbContainer||{text:"--select container--",value:"select-container"},u.target.griddbLimit=u.target.griddbLimit||1e4,u.target.griddbOffset=u.target.griddbOffset||0,u.target.alias=u.target.alias||"",u.target.griddbColumns=u.target.griddbColumns||[],u.target.griddbTimeSeriesViewCols=u.target.griddbTimeSeriesViewCols||[],u.target.griddbTableViewCols=u.target.griddbTableViewCols||[],u.target.griddbTimeColumn=u.target.griddbTimeColumn||{text:"--select time column--",value:"time-column",fake:!0},u.target.griddbSelectedViewCols=u.target.griddbSelectedViewCols||[],u.target.griddbViewColDisplayModel=u.target.griddbViewColDisplayModel||{current:{value:["$__all"],text:"All"}},u.target.griddbTimeCols=u.target.griddbTimeCols||[],u.target.griddbNotTimeCols=u.target.griddbNotTimeCols||[],void 0===u.target.griddbNotSpeContAndColm&&(u.target.griddbNotSpeContAndColm=!0),u.target.griddbIsTimeSampling=u.target.griddbIsTimeSampling||!1,u.$scope=e,u.target.griddbWhereCondition=u.target.griddbWhereCondition||[],u.target.griddbSelectedContainerType=u.target.griddbSelectedContainerType||"",u.target.query=u.target.query||"SELECT *",u.target.rawQuery=u.target.rawQuery||!1,"table"===u.panelCtrl.panel.type?u.target.format=d.GridDBConstant.FORMAT.table:u.target.format=d.GridDBConstant.FORMAT.timeSeries,u.getGriDBVariable(),u.getContainers(),u.initialDefaultValues(),u.fixSegments(),u}var r,n,u;return t.$inject=["$scope","$injector","templateSrv","$q","uiSegmentSrv"],function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,e),r=t,(n=[{key:"updateViewCol",value:function(e){if(void 0===e)throw{message:"Update view column fail."};e.current.value instanceof Array?e.options[0].selected?(this.target.format===d.GridDBConstant.FORMAT.timeSeries&&(this.target.griddbSelectedViewCols=this.target.griddbTimeSeriesViewCols),this.target.format===d.GridDBConstant.FORMAT.table&&(this.target.griddbSelectedViewCols=this.target.griddbTableViewCols)):this.target.griddbSelectedViewCols=e.current.value:this.target.griddbSelectedViewCols=[e.current.text],this.panelCtrl.refresh()}},{key:"toggleEditorMode",value:function(){this.target.rawQuery||(this.target.query=this.queryModel.render()),this.target.rawQuery=!this.target.rawQuery,"table"===this.panelCtrl.panel.type?this.target.format=d.GridDBConstant.FORMAT.table:this.target.format=d.GridDBConstant.FORMAT.timeSeries}},{key:"onChangeContainer",value:function(e){if(void 0!==e){var t;this.checkIfSpecifyContainerAndTimeColumn();for(var r=-1,n=0;n<this.griddbVariables.length;n++)this.griddbVariables[n].text===this.target.griddbContainer.text&&this.griddbVariables[n].value===this.target.griddbContainer.value&&(r=n);if(r>=0){var i=this.templateSrv.variables[r].current;t="All"===i.text&&"$__all"===i.value?"":i.text}else t=this.target.griddbContainer.text;this.getColumns(t),this.panelCtrl.refresh()}}},{key:"onChangeColumn",value:function(e){void 0!==e&&(this.checkIfSpecifyContainerAndTimeColumn(),this.target.griddbNotSpeContAndColm||0===this.target.griddbSelectedViewCols.length&&this.updateColumnList(),this.panelCtrl.refresh())}},{key:"whereSegmentUpdated",value:function(e,t){if(!(void 0!==e&&t>=0))throw{message:"Update where segment fail."};this.griddbWhereSegments[t]=e,e.value===this.removeTagFilterSegment.value&&(this.griddbWhereSegments.splice(t,3),0===this.griddbWhereSegments.length&&this.griddbWhereSegments.push(this.uiSegmentSrv.newPlusButton()),this.griddbWhereSegments.length>2&&(this.griddbWhereSegments.splice(Math.max(t-1,0),1),"plus-button"!==this.griddbWhereSegments[this.griddbWhereSegments.length-1].type&&this.griddbWhereSegments.push(this.uiSegmentSrv.newPlusButton()))),"plus-button"===e.type&&(t>2&&this.griddbWhereSegments.splice(t,0,this.uiSegmentSrv.newCondition("AND")),this.griddbWhereSegments.push(this.uiSegmentSrv.newOperator("=")),this.griddbWhereSegments.push(this.uiSegmentSrv.newFake("--input value--","value","query-segment-value")),e.type="key",e.cssClass="query-segment-key"),t+1===this.griddbWhereSegments.length&&t>=2&&this.griddbWhereSegments.push(this.uiSegmentSrv.newPlusButton()),this.rebuildTargetWhereConditions()}},{key:"getContainers",value:function(){var e=this;this.datasource.getContainerList().then(function(t){e.griddbContainers=g.default.convertListContainerToObject(t.names),e.griddbContainers=e.griddbVariables.concat(e.griddbContainers)}).catch(function(e){throw{message:"Can not get container list."}})}},{key:"getColumns",value:function(e){var t=this;this.revertAllValueToDefaultAfterChangeContainer(),this.datasource.getColumnList(e).then(function(e){var r=[],n=[];e.columns.forEach(function(e){"TIMESTAMP"===e.type&&n.push(e.name),r.push(e.name)}),t.target.griddbSelectedContainerType=e.container_type,t.target.griddbTableViewCols=r,t.target.griddbTimeSeriesViewCols=g.default.getViewColListinTimeSeries(e.columns),t.target.griddbColumns=g.default.convertToSegmentFormat(r),t.target.griddbTimeCols=g.default.convertToSegmentFormat(n),t.target.griddbWhereCondition=g.default.convertToWhereCondition(e.columns),t.checkIfSpecifyContainerAndTimeColumn(),t.target.griddbNotSpeContAndColm||t.updateColumnList()})}},{key:"getWhereOption",value:function(e,t){if(!(void 0!==e&&t>=0))throw{message:"Can not get option for where."};if(!this.target.griddbNotSpeContAndColm){if("condition"===e.type)return this.$q.when([this.uiSegmentSrv.newSegment("AND"),this.uiSegmentSrv.newSegment("OR"),this.uiSegmentSrv.newSegment("XOR"),this.uiSegmentSrv.newSegment("AND NOT"),this.uiSegmentSrv.newSegment("OR NOT"),this.uiSegmentSrv.newSegment("XOR NOT")]);if("operator"===e.type)return this.$q.when(this.uiSegmentSrv.newOperators(["=",">=",">","<=","<","<>","LIKE"]));if("plus-button"===e.type)return this.$q.when(this.target.griddbWhereCondition);if("value"===e.type)return this.$q.when([]);if("key"===e.type){var r=[e],n=this.target.griddbTableViewCols.filter(function(t){return t!==e.value});return this.convertToWhereSegment(n).forEach(function(e){r.splice(0,0,e)}),r.splice(0,0,this.removeTagFilterSegment),this.$q.when(r)}}}},{key:"getGriDBVariable",value:function(){var e=this.templateSrv.variables,t=[];e.forEach(function(e){t.push({text:"$"+e.name,value:"$"+e.name})}),this.griddbVariables=t}},{key:"checkIfSpecifyContainerAndTimeColumn",value:function(){this.target.format===d.GridDBConstant.FORMAT.timeSeries&&"select-container"!==this.target.griddbContainer.value&&!1===this.target.griddbTimeColumn.fake&&(this.target.griddbNotSpeContAndColm=!1),this.target.format===d.GridDBConstant.FORMAT.table&&"select-container"!==this.target.griddbContainer.value&&(this.target.griddbNotSpeContAndColm=!1)}},{key:"revertAllValueToDefaultAfterChangeContainer",value:function(){this.target.griddbViewColDisplayModel={current:{value:["$__all"],text:"All"}},this.target.griddbTimeColumn={text:"--select time column--",value:"time-column",fake:!0},this.target.griddbColumns=[],this.target.griddbSelectedContainerType="",this.target.format===d.GridDBConstant.FORMAT.timeSeries&&(this.target.griddbNotSpeContAndColm=!0),this.target.format===d.GridDBConstant.FORMAT.table&&(this.target.griddbNotSpeContAndColm=!1),this.target.griddbNotTimeCols.splice(0,this.target.griddbNotTimeCols.length),0!==this.griddbWhereSegments.length&&(this.griddbWhereSegments.splice(0,this.griddbWhereSegments.length),this.griddbWhereSegments.push(this.uiSegmentSrv.newPlusButton())),this.target.griddbLimit=1e4,this.target.griddbOffset=0,this.target.griddbTableViewCols=[],this.target.griddbTimeSeriesViewCols=[],this.target.griddbTimeCols=[],this.target.griddbWheres=[],this.target.griddbIsTimeSampling=!1,this.target.griddbTQL="",this.target.alias="",this.target.griddbSelectedViewCols=[]}},{key:"updateColumnList",value:function(){this.target.griddbSelectedViewCols=[],this.target.format===d.GridDBConstant.FORMAT.timeSeries&&(this.target.griddbViewColDisplayModel=g.default.createDataForViewCol(this.target.griddbTimeSeriesViewCols)),this.target.format===d.GridDBConstant.FORMAT.table&&(this.target.griddbViewColDisplayModel=g.default.createDataForViewCol(this.target.griddbTableViewCols)),this.target.griddbViewColDisplayModel.options[0].selected=!0,this.target.griddbViewColDisplayModel.current={value:["$__all"],text:"All"};for(var e=1;e<this.target.griddbViewColDisplayModel.options.length;e++)this.target.griddbSelectedViewCols.push(this.target.griddbViewColDisplayModel.options[e].text)}},{key:"fixSegments",value:function(){var e=this.griddbWhereSegments.length,t=this.griddbWhereSegments[Math.max(e-1,0)];t&&"plus-button"===t.type||this.griddbWhereSegments.push(this.uiSegmentSrv.newPlusButton())}},{key:"rebuildTargetWhereConditions",value:function(){var e=this,t=[],r=0,n="";c.each(this.griddbWhereSegments,function(i,a){"key"===i.type?(0===t.length&&t.push({}),t[r].key=i.value):"value"===i.type?((n=t[r].operator)&&(e.griddbWhereSegments[a-1]=e.uiSegmentSrv.newOperator(n),t[r].operator=n),t[r].value=i.value):"condition"===i.type?(t.push({condition:i.value}),r+=1):"operator"===i.type&&(t[r].operator=i.value)}),this.target.griddbWheres=t,this.panelCtrl.refresh()}},{key:"initialDefaultValues",value:function(){this.griddbWhereSegments=[];var e=!0,t=!1,r=void 0;try{for(var n,i=this.target.griddbWheres[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var a=n.value;a.condition&&this.griddbWhereSegments.push(this.uiSegmentSrv.newCondition(a.condition)),this.griddbWhereSegments.push(this.uiSegmentSrv.newKey(a.key)),this.griddbWhereSegments.push(this.uiSegmentSrv.newOperator(a.operator)),this.griddbWhereSegments.push(this.uiSegmentSrv.newKeyValue(a.value))}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}}},{key:"getCollapsedText",value:function(){return new l.default(this.target).render()}},{key:"convertToWhereSegment",value:function(e){var t,r=this,n=[];return e.forEach(function(e){t=r.uiSegmentSrv.newSegment({fake:!1,value:e}),n.push(t)}),n}}])&&i(r.prototype,n),u&&i(r,u),t}(u.QueryCtrl);m.templateUrl="partials/query.editor.html",t.DataQueryCtrl=m},function(e,r){e.exports=t},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.current.access="proxy",this.current.basicAuth=!0,this.current.jsonData.minInterval||(this.current.jsonData.minInterval="1s")};n.templateUrl="partials/config.html",t.ConfigCtrl=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)};n.templateUrl="partials/annotations.editor.html",t.AnnotationsQueryCtrl=n}])});